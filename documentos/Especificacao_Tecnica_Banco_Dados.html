
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Especificação Técnica do Banco de Dados - SIMRE-CEAVS</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; padding: 40px; }
        h1 { color: #1E40AF; border-bottom: 2px solid #1E40AF; padding-bottom: 10px; }
        h2 { color: #1D4ED8; margin-top: 40px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        h3 { color: #2563EB; margin-top: 30px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.9em; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        th { background-color: #EBF5FF; color: #1E40AF; }
        code { background-color: #f4f4f4; padding: 2px 5px; border-radius: 4px; font-family: Consolas, monospace; color: #d63384; }
        pre { background-color: #f8f9fa; padding: 15px; border: 1px solid #ddd; border-radius: 5px; overflow-x: auto; font-family: Consolas, monospace; font-size: 0.85em; }
        .toc { background-color: #f9fafb; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 40px; }
        .toc a { text-decoration: none; color: #2563EB; display: block; margin-bottom: 5px; }
        .toc a:hover { text-decoration: underline; }
        .meta-info { margin-bottom: 40px; background: #fff; border: 1px solid #ddd; padding: 20px; }
        .meta-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; }
        .meta-label { font-weight: bold; color: #555; }
        .center { text-align: center; }
    </style>
</head>
<body>

    <div class="center">
        <h1>Especificação Técnica de Banco de Dados</h1>
        <h2>Painel de Controle de Monitoramento (SIMRE-CEAVS)</h2>
    </div>

    <div class="meta-info">
        <div class="meta-row"><span class="meta-label">Projeto:</span> <span>SIMRE-CEAVS</span></div>
        <div class="meta-row"><span class="meta-label">Versão do Documento:</span> <span>1.3.0</span></div>
        <div class="meta-row"><span class="meta-label">Data de Emissão:</span> <span>19/11/2025</span></div>
        <div class="meta-row"><span class="meta-label">Responsável Técnico:</span> <span>ESTÊNIO COUTO BORGES JÚNIOR</span></div>
        <div class="meta-row"><span class="meta-label">SGBD:</span> <span>Microsoft SQL Server 2019+</span></div>
    </div>

    <div class="toc">
        <h3>Sumário</h3>
        <a href="#historico">1. Histórico de Versões</a>
        <a href="#modelo-fisico">2. Modelo Físico (Script SQL)</a>
        <a href="#dicionario">3. Dicionário de Dados</a>
        <a href="#dimensionamento">4. Dimensionamento e Volumetria</a>
    </div>

    <h2 id="historico">1. Histórico de Versões</h2>
    <table>
        <thead>
            <tr>
                <th>Versão</th>
                <th>Data</th>
                <th>Autor</th>
                <th>Descrição das Alterações</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1.0.0</td>
                <td>19/11/2025</td>
                <td>Estênio Couto Borges Júnior</td>
                <td>Criação inicial do documento.</td>
            </tr>
            <tr>
                <td>1.3.0</td>
                <td>19/11/2025</td>
                <td>Estênio Couto Borges Júnior</td>
                <td>Adição da tabela LOG_AUDITORIA para rastreamento de histórico de alterações.</td>
            </tr>
        </tbody>
    </table>

    <h2 id="modelo-fisico">2. Modelo Físico (Script SQL Server Completo)</h2>
    <p>Abaixo encontra-se o script DDL completo para a criação da estrutura do banco de dados.</p>

<pre>
USE [master]
GO
CREATE DATABASE [SIMRECEAVS]
GO
USE [SIMRECEAVS]
GO

-- Tabela de Usuários
CREATE TABLE [dbo].[LOGIN](
    [ID_LOGIN] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [NOME] [varchar](100) NOT NULL,
    [EMAIL] [varchar](100) NOT NULL UNIQUE,
    [LOGIN] [varchar](50) NOT NULL UNIQUE,
    [SENHA] [varchar](100) NOT NULL, -- Hash BCrypt
    [PERFIL] [varchar](20) DEFAULT 'USER' NOT NULL,
    [INATIVO] [bit] DEFAULT 0,
    [DATA_CRIACAO] [datetime] DEFAULT GETDATE()
)
GO

-- Tabela de Auditoria (NOVA)
CREATE TABLE [dbo].[LOG_AUDITORIA](
    [ID_LOG] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [ID_USUARIO] [int] NULL, -- Nullable pois o usuário pode ter sido excluído ou ser login falho
    [NOME_USUARIO] [varchar](100) NULL, -- Snapshot do nome no momento da ação
    [TIPO_ACAO] [varchar](20) NOT NULL, -- INSERT, UPDATE, DELETE, LOGIN, LOGIN_FAIL
    [TABELA_AFETADA] [varchar](50) NULL,
    [ID_REGISTRO_AFETADO] [varchar](50) NULL,
    [DADOS_ANTERIORES] [nvarchar](MAX) NULL, -- JSON ou Texto dos dados antes da alteração
    [DADOS_NOVOS] [nvarchar](MAX) NULL, -- JSON ou Texto dos novos dados
    [IP_ORIGEM] [varchar](50) NULL,
    [DATA_HORA] [datetime] DEFAULT GETDATE()
)
GO

-- Tabelas de Domínio e Geografia
CREATE TABLE [dbo].[STATUS](
    [ID_STATUS] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [NOME] [varchar](50) NOT NULL,
    [DESCRICAO] [varchar](150) NULL,
    [COR] [varchar](20) NULL
)
GO

CREATE TABLE [dbo].[NATUREZA](
    [ID_NATUREZA] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [DESCRICAO_NATUREZA] [varchar](150) NOT NULL
)
GO

-- Tabelas Geográficas
CREATE TABLE [dbo].[PAIS] ( 
    [ID_PAIS] int IDENTITY(1,1) PRIMARY KEY, 
    [NOME] varchar(100) NOT NULL UNIQUE 
);

CREATE TABLE [dbo].[ESTADO] ( 
    [ID_ESTADO] int IDENTITY(1,1) PRIMARY KEY, 
    [NOME] varchar(50) NOT NULL, 
    [ID_PAIS] int NOT NULL FOREIGN KEY REFERENCES PAIS(ID_PAIS) 
);

CREATE TABLE [dbo].[CIDADE] ( 
    [ID_CIDADE] int IDENTITY(1,1) PRIMARY KEY, 
    [NOME] varchar(100) NOT NULL, 
    [ID_ESTADO] int NOT NULL FOREIGN KEY REFERENCES ESTADO(ID_ESTADO) 
);

CREATE TABLE [dbo].[ICMRA] ( [ID_ICMRA] int IDENTITY(1,1) PRIMARY KEY, [DESCRICAO] varchar(255) );

-- Tabelas Organizacionais
CREATE TABLE [dbo].[AREA](
    [ID_AREA] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [NOME_AREA] [varchar](30) NOT NULL,
    [SIGLA] [nvarchar](10) NULL,
    [DESCRICAO] [varchar](150) NULL
)
GO

CREATE TABLE [dbo].[REPRESENTANTE](
    [ID_REPRESENTANTE] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [ID_AREA] [int] NULL FOREIGN KEY REFERENCES [dbo].[AREA]([ID_AREA]),
    [EMAIL] [varchar](100) NULL,
    [NOME] [varchar](30) NULL,
    [TITULARIDADE] [varchar](15) NULL
)
GO

-- Tabelas Associativas
CREATE TABLE [dbo].[NATUREZA_AREA](
    [ID_AREA] [int] NULL FOREIGN KEY REFERENCES [dbo].[AREA]([ID_AREA]),
    [ID_NATUREZA] [int] NULL FOREIGN KEY REFERENCES [dbo].[NATUREZA]([ID_NATUREZA])
)
GO

CREATE TABLE [dbo].[ICMRA_NATUREZA](
    [ID_ICMRA] [int] NULL FOREIGN KEY REFERENCES [dbo].[ICMRA]([ID_ICMRA]),
    [ID_NATUREZA] [int] NULL FOREIGN KEY REFERENCES [dbo].[NATUREZA]([ID_NATUREZA])
)
GO

-- Tabela Principal: RUMOR_EVENTO
CREATE TABLE [dbo].[RUMOR_EVENTO](
    [ID_RUMOR_EVENTO] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [IDU] [varchar](20) NULL,
    [TITULO] [varchar](255) NOT NULL,
    [DESCRICAO] [varchar](500) NULL,
    [LOCAL_EVENTO] [varchar](100) NULL,
    [VERACIDADE] [varchar](50) NULL,
    [FUNDAMENTO_VERACIDADE] [varchar](255) NULL,
    [NOTIFICADOR_FONTE] [varchar](100) NULL,
    [DATA_RECEBIMENTO] [date] NULL,
    [TIPO_VIGILANCIA] [varchar](50) NULL,
    [TIPO_ENCAMINHAMENTO] [varchar](50) NULL,
    [NIVEL_CONFIANCA] [varchar](50) NULL,
    
    [ID_STATUS] [int] NULL FOREIGN KEY REFERENCES [dbo].[STATUS]([ID_STATUS]),
    [ID_NATUREZA] [int] NULL FOREIGN KEY REFERENCES [dbo].[NATUREZA]([ID_NATUREZA]),
    [ID_ICMRA] [int] NULL FOREIGN KEY REFERENCES [dbo].[ICMRA]([ID_ICMRA]),
    
    -- Geografia vinculada
    [ID_PAIS] [int] NULL FOREIGN KEY REFERENCES [dbo].[PAIS]([ID_PAIS]),
    [ID_ESTADO] [int] NULL FOREIGN KEY REFERENCES [dbo].[ESTADO]([ID_ESTADO]),
    [ID_CIDADE] [int] NULL FOREIGN KEY REFERENCES [dbo].[CIDADE]([ID_CIDADE]),
    
    [ID_USUARIO_CADASTRO] [int] NULL FOREIGN KEY REFERENCES [dbo].[LOGIN]([ID_LOGIN]),
    [DATA_CADASTRO] [datetime] DEFAULT GETDATE()
)
GO

-- Comunicação de Risco
CREATE TABLE [dbo].[COMUNICACAO](
    [ID_COMUNICACAO] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [DATA_EMAIL] [date] NULL,
    [ACAO] [varchar](100) NULL,
    [CNPJ] [varchar](20) NULL,
    [CATEGORIA] [varchar](100) NULL,
    [ESCOPO] [varchar](100) NULL,
    [PRODUTO] [varchar](100) NULL,
    [LOTE] [varchar](50) NULL,
    [NOME_EMPRESA] [varchar](100) NULL,
    [RESOLUCAO] [varchar](100) NULL,
    [URL] [varchar](255) NULL,
    [DATA_DOU] [date] NULL,
    [MOTIVO] [varchar](255) NULL,
    [EMAIL_NOTIFICADOR] [varchar](100) NULL,
    [ID_USUARIO_CADASTRO] [int] NULL FOREIGN KEY REFERENCES [dbo].[LOGIN]([ID_LOGIN]),
    [DATA_CADASTRO] [datetime] DEFAULT GETDATE()
)
GO

-- Atualizações
CREATE TABLE [dbo].[ATUALIZACAO](
    [ID_ATUALIZACAO] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [ID_RUMOR_EVENTO] [int] NULL FOREIGN KEY REFERENCES [dbo].[RUMOR_EVENTO]([ID_RUMOR_EVENTO]),
    [DESCRICAO_ATUALIZACAO] [varchar](500) NULL,
    [DATA_ATUALIZACAO] [datetime] DEFAULT GETDATE(),
    [ID_USUARIO_CADASTRO] [int] NULL FOREIGN KEY REFERENCES [dbo].[LOGIN]([ID_LOGIN])
)
GO

-- Tags (Many-to-Many)
CREATE TABLE [dbo].[TAG](
    [ID_TAG] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [NOME_TAG] [varchar](50) NOT NULL UNIQUE
)
GO

CREATE TABLE [dbo].[RUMOR_TAG](
    [ID_RUMOR_EVENTO] [int] NOT NULL FOREIGN KEY REFERENCES [dbo].[RUMOR_EVENTO]([ID_RUMOR_EVENTO]),
    [ID_TAG] [int] NOT NULL FOREIGN KEY REFERENCES [dbo].[TAG]([ID_TAG]),
    PRIMARY KEY ([ID_RUMOR_EVENTO], [ID_TAG])
)
GO

-- Avaliação de Risco (1:1)
CREATE TABLE [dbo].[RISCO](
    [ID_RISCO] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [ID_RUMOR_EVENTO] [int] NOT NULL UNIQUE FOREIGN KEY REFERENCES [dbo].[RUMOR_EVENTO]([ID_RUMOR_EVENTO]),
    [GRAVIDADE] [int] NULL,
    [VULNERABILIDADE] [int] NULL,
    [CAPACIDADE_ENFRENTAMENTO] [int] NULL,
    [FREQUENCIA] [int] NULL,
    [PROBABILIDADE] [int] NULL,
    [IMPACTO] [decimal](5,2) NULL,
    [MATRIZ_RISCO] [decimal](5,2) NULL,
    [RISCO_SAUDE] [varchar](255) NULL,
    [RECOMENDACAO] [varchar](255) NULL,
    [PAUTADO_CMA] [bit] DEFAULT 0
)
GO

-- Verificação (1:1)
CREATE TABLE [dbo].[VERIFICACAO](
    [ID_VERIFICACAO] [int] IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [ID_RUMOR_EVENTO] [int] NOT NULL FOREIGN KEY REFERENCES [dbo].[RUMOR_EVENTO]([ID_RUMOR_EVENTO]),
    [VERIFICADO] [bit] DEFAULT 0,
    [DATA_VERIFICACAO] [date] NULL,
    [OBSERVACAO] [varchar](500) NULL,
    [ID_USUARIO_VERIFICADOR] [int] NULL FOREIGN KEY REFERENCES [dbo].[LOGIN]([ID_LOGIN])
)
GO
</pre>

    <h2 id="dicionario">3. Dicionário de Dados (Novas Tabelas)</h2>

    <h3>3.1. Tabela: LOG_AUDITORIA</h3>
    <table>
        <thead><tr><th>Atributo</th><th>Tipo</th><th>Descrição</th></tr></thead>
        <tbody>
            <tr><td>ID_LOG</td><td>INT</td><td>Identificador único do log.</td></tr>
            <tr><td>ID_USUARIO</td><td>INT</td><td>ID do usuário que realizou a ação.</td></tr>
            <tr><td>TIPO_ACAO</td><td>VARCHAR</td><td>INSERT, UPDATE, DELETE, LOGIN, LOGIN_FAIL.</td></tr>
            <tr><td>DADOS_ANTERIORES</td><td>NVARCHAR(MAX)</td><td>Snapshot dos dados antes da alteração (JSON).</td></tr>
            <tr><td>DADOS_NOVOS</td><td>NVARCHAR(MAX)</td><td>Snapshot dos dados após a alteração (JSON).</td></tr>
        </tbody>
    </table>

</body>
</html>
